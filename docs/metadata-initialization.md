# Metadata Initialization

> This page contains information about how metadata is loaded and processed by UNET and Unreal Engine.  
> All information is divided by steps.

## Unreal Engine startup

Unreal Engine is modular (for more info read about [Plugins in Unreal Engine](https://docs.unrealengine.com/5.0/en-US/plugins-in-unreal-engine/)).
It means that on startup all required modules (plugins) have to be loaded.

All types that have metadata generated by UHT will have one line of code, which makes a call to a function from internal type loading system.
For C++ compiler this line of code looks like an initializer of a static field. Initializers of static fields in C++ are called on assembly load.  
This means that metadata of UE types is loaded when assembly is initializing.

It is possible to mimic this behavior by exposing this functionality to UNET with a bit of C++ code.

## Loading of UNET Module

To use C# code inside of already existing C++ application, making a hosted CLR environment is the only way.

> For more info read .NET documentation about [CLR hosting](https://docs.microsoft.com/en-us/dotnet/core/tutorials/netcore-hosting)

When native UNET assembly is loading, it will host CLR under the hood and load all UNET assemblies and provide them some function pointers, that are required for interaction between managed and unmanaged parts of UNET.

After all managed UNET assemblies are initialized, UNET Plugin Loader will search for managed assemblies at `[ProjectPath]/Binaries/Managed` with `.unetplugin` extension.  
Special extension is used to find all required assemblies before they loaded, which will improve performance on startup.

## Loading of UNET Plugins

Each UNET Plugin is loaded to it's own `AssemblyLoadContext`, but it's dependencies will be loaded in shared "Default" context.

> For more info read .NET documentation about [AssemblyLoadContext](https://docs.microsoft.com/en-us/dotnet/core/dependency-loading/understanding-assemblyloadcontext)

When UNET Plugin is detected, UNET Plugin Loader will load it and search for special assembly attribute containing `MetadataProvider` instance, which will provide all metadata that was produced by UNET Source Generator. 

For each type that has metadata, it will just use Unreal Engine type loading system and provide all required data to register exposed .NET types.